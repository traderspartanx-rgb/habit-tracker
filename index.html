<!DOCTYPE html>
<html lang="en">
<head>
 <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000"> 
<meta charset="UTF-8">
<title>Habit Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js')
    .then(() => console.log('SW registered'))
    .catch(err => console.log('SW failed', err));
}
</script>  
body{
  font-family: 'Arial', sans-serif;
  background: #f4f6f5;
  padding: 20px;
  margin: 0;
}

/* HEADER */
.header{
  background: #dde3e0;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-radius: 10px;
}
.month-box{
  cursor: pointer;
  position: relative;
}
.month{
  font-size: 28px;
  font-weight: 700;
  color: #000;
  user-select: none;
}
.month-select{
  display:none;
  margin-top: 5px;
  font-size: 16px;
  font-weight: 700;
  position: absolute;
  z-index: 100;
}

/* STATS */
.stats{
  display: flex;
  gap: 30px;
  text-align: center;
  color: #000;
}
.stats div{
  font-size: 14px;
}

/* PROGRESS */
.progress-bar{
  width: 150px;
  height: 14px;
  background: #ccc;
  border-radius: 7px;
  margin-top: 4px;
  overflow: hidden;
}
.progress-fill{
  height: 100%;
  background: #000;
  width: 0%;
  transition: width 0.3s;
}

/* ADD BUTTON */
.add-btn{
  margin: 14px 0;
  padding: 10px 20px;
  background: #000;
  color: #fff;
  border: none;
  border-radius: 25px;
  font-weight: 700;
  cursor: pointer;
  transition: 0.3s;
}
.add-btn:hover{
  background: #333;
}

/* TABLE */
table{
  width: 100%;
  border-collapse: collapse;
  background: #e9efec;
  margin-top: 10px;
  border-radius: 10px;
  overflow: hidden;
}
th, td{
  border: 1px solid #aaa;
  padding: 5px;
  text-align: center;
  font-size: 12px;
}
th{
  background: #cfd8d4;
  font-weight: 700;
}

/* MY HABITS - Line removed, Text centered and adjusted */
.myhabits{
  text-align: center;
  font-size: 17px; 
  font-weight: 700;
  border-bottom: none !important; /* Niche wali line hatayi */
  vertical-align: middle; /* Vertical centering */
  height: 60px; /* Box size maintain karne ke liye */
}

/* HABIT CELL */
.habit-cell {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 10px;
  height: 35px;
  position: relative;
}
.habit-input {
  border: none;
  background: transparent;
  font-weight: 700;
  width: 100%;
  outline: none;
  text-align: center;
  font-size: 15px;
  color: #000;
}

/* DELETE ICON */
.cross {
  display: none;
  cursor: pointer;
  user-select: none;
  width: 14px;
  height: 14px;
  position: absolute;
  right: 8px;
}
.habit-input:focus + .cross {
  display: inline-block;
}

/* CHECKBOX */
.cb{
  width: 18px;
  height: 18px;
  cursor: pointer;
  border-radius: 4px;
  border: 2px solid #000;
  appearance: none;
  position: relative;
  vertical-align: middle;
}
.cb:checked{
  background: #000;
}
.cb:checked::after{
  content: "";
  display: block;
  width: 5px;
  height: 9px;
  border: solid #fff;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
  position: absolute;
  top: 1px;
  left: 5px;
}

.gap-row td{
  border: none;
  height: 14px;
  background: #f4f6f5;
}

.footer{
  background: #dfe6e3;
  font-weight: 700;
}

.graph-box{
  margin-top: 20px;
  background: #eef3f1;
  padding: 12px;
  border-radius: 10px;
}
</style>
</head>

<body>

<div class="header">
  <div class="month-box" id="monthBox">
    <div class="month" id="month">DECEMBER</div>
    <select class="month-select" id="monthSelect" onchange="changeMonth()">
      <option value="0">JANUARY</option>
      <option value="1">FEBRUARY</option>
      <option value="2">MARCH</option>
      <option value="3">APRIL</option>
      <option value="4">MAY</option>
      <option value="5">JUNE</option>
      <option value="6">JULY</option>
      <option value="7">AUGUST</option>
      <option value="8">SEPTEMBER</option>
      <option value="9">OCTOBER</option>
      <option value="10">NOVEMBER</option>
      <option value="11">DECEMBER</option>
    </select>
  </div>

  <div class="stats">
    <div>Habits<br><b id="hc">0</b></div>
    <div>Done<br><b id="done">0</b></div>
    <div>Not Done<br><b id="notDone">0</b></div>
    <div>
      Progress <b id="per">0%</b>
      <div class="progress-bar"><div class="progress-fill" id="pf"></div></div>
    </div>
  </div>
</div>

<button class="add-btn" onclick="addHabit()">+ Add Habit</button>

<table>
<thead>
<tr>
  <th class="myhabits" rowspan="2">My Habits</th> <th colspan="30" style="border-bottom: 1px solid #aaa;">Days</th>
</tr>
<tr>
  <script>
    for(let i=1;i<=30;i++){
      document.write("<th>"+i+"</th>");
    }
  </script>
</tr>
</thead>

<tbody id="body"></tbody>

<tr class="gap-row"><td colspan="31"></td></tr>

<tfoot>
<tr class="footer" id="doneRow"><td>Done</td></tr>
<tr class="footer" id="notRow"><td>Not Done</td></tr>
<tr class="footer" id="perRow"><td>Progress %</td></tr>
</tfoot>
</table>

<div class="graph-box">
  <canvas id="chart" height="60"></canvas>
</div>

<script>
let habits = JSON.parse(localStorage.getItem("habits") || "[]");
const body = document.getElementById("body");
const hc = document.getElementById("hc");
const doneBox = document.getElementById("done");
const notDoneBox = document.getElementById("notDone");
const per = document.getElementById("per");
const pf = document.getElementById("pf");

const monthNames = ["JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"];
let currentMonth = new Date().getMonth();
const monthEl = document.getElementById("month");
const monthSelect = document.getElementById("monthSelect");

monthEl.innerText = monthNames[currentMonth];
monthSelect.value = currentMonth;

monthEl.addEventListener("click",()=>{
  monthSelect.style.display = monthSelect.style.display === "block" ? "none" : "block";
});

function changeMonth(){
  currentMonth = monthSelect.value;
  monthEl.innerText = monthNames[currentMonth];
  monthSelect.style.display = "none";
}

const chart = new Chart(document.getElementById("chart"),{
  type:"line",
  data:{
    labels:[...Array(30).keys()].map(i=>i+1),
    datasets:[{
      data:new Array(30).fill(0),
      fill:true,
      backgroundColor:"rgba(0,0,0,.2)",
      borderColor:"#000",
      tension:.4
    }]
  },
  options:{plugins:{legend:{display:false}},scales:{y:{min:0,max:100}}}
});

function save(){localStorage.setItem("habits", JSON.stringify(habits))}

function addHabit(){
  habits.push({name:"", checks:new Array(30).fill(false)});
  save();
  render();
}

function del(i){
  habits.splice(i,1);
  save();
  render();
}

function toggle(i,d,v){
  habits[i].checks[d]=v;
  save();
  updateAll();
}

function render(){
  body.innerHTML="";
  habits.forEach((h,i)=>{
    let tr = document.createElement("tr");
    tr.innerHTML=`<td class="habit-cell">
      <input class="habit-input" placeholder="Enter habit" value="${h.name}"
      oninput="habits[${i}].name=this.value;save()">
      <svg class="cross" onmousedown="del(${i})" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </td>`;
    h.checks.forEach((c,d)=>{
      tr.innerHTML += `<td>
        <input class="cb" type="checkbox" ${c?"checked":""} onchange="toggle(${i},${d},this.checked)">
      </td>`;
    });
    body.appendChild(tr);
  });
  hc.innerText = habits.length;
  updateAll();
}

function updateAll(){
  let totalDone = 0;
  let totalPossible = habits.length * 30;
  let daily = new Array(30).fill(0);

  habits.forEach(h=>h.checks.forEach((c,i)=>{
    if(c){
        totalDone++;
        daily[i]+=100/habits.length;
    }
  }));

  doneBox.innerText = totalDone;
  notDoneBox.innerText = totalPossible - totalDone;
  
  let p = habits.length ? Math.round(totalDone/totalPossible*100) : 0;
  per.innerText = p+"%";
  pf.style.width = p+"%";

  document.getElementById("doneRow").innerHTML="<td>Done</td>"+daily.map(v=>`<td>${Math.round(v*habits.length/100)}</td>`).join("");
  document.getElementById("notRow").innerHTML="<td>Not Done</td>"+daily.map(v=>`<td>${habits.length-Math.round(v*habits.length/100)}</td>`).join("");
  document.getElementById("perRow").innerHTML="<td>Progress %</td>"+daily.map(v=>`<td>${Math.round(v)}%</td>`).join("");

  chart.data.datasets[0].data = daily;
  chart.update();
}

render();
</script>

</body>

</html>
